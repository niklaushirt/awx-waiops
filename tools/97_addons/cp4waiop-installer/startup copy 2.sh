echo "*****************************************************************************************************************************"
echo "*****************************************************************************************************************************"
echo "      __________  __ ___       _____    ________            "
echo "     / ____/ __ \/ // / |     / /   |  /  _/ __ \____  _____"
echo "    / /   / /_/ / // /| | /| / / /| |  / // / / / __ \/ ___/"
echo "   / /___/ ____/__  __/ |/ |/ / ___ |_/ // /_/ / /_/ (__  ) "
echo "   \____/_/      /_/  |__/|__/_/  |_/___/\____/ .___/____/  "
echo "                                             /_/            "
echo ""
echo "*****************************************************************************************************************************"
echo " üê• CloudPak for Watson AIOPs - Install and configure AWX in local cluster"
echo "*****************************************************************************************************************************"
echo "  "
echo ""
echo ""

export INSTALL_REPO=https://github.com/niklaushirt/awx-waiops.git

echo "   ------------------------------------------------------------------------------------------------------------------------------"
echo "   üåè  Get Installer files from $INSTALL_REPO"
git clone $INSTALL_REPO| sed 's/^/      /'
cd awx-waiops| sed 's/^/      /'
ls -al| sed 's/^/      /'


echo "   ------------------------------------------------------------------------------------------------------------------------------"
echo "   üöÄ  Create Clusterrole binding"
oc create clusterrolebinding awx-default --clusterrole=cluster-admin --serviceaccount=awx:default| sed 's/^/      /'

echo ""
echo "   ------------------------------------------------------------------------------------------------------------------------------"
echo "   üöÄ  Create AWX Operator"
oc apply -f ./ansible/templates/awx/operator-install.yaml| sed 's/^/      /'

echo ""
echo "   ------------------------------------------------------------------------------------------------------------------------------"
echo "   üöÄ  Create AWX Instance"
oc apply -f ./ansible/templates/awx/awx-deploy-cr.yml| sed 's/^/      /'

echo ""
echo "   ------------------------------------------------------------------------------------------------------------------------------"
echo "   üï¶  Wait for AWX pods ready"
while [ `oc get pods -n awx| grep postgres|grep 1/1 | wc -l| tr -d ' '` -lt 1 ]
do
      echo "       AWX not ready yet. Waiting 15 seconds"
      sleep 15
done


echo "*****************************************************************************************************************************"
echo " ‚úÖ DONE"
echo "*****************************************************************************************************************************"


while true; do echo "Still alive"; sleep 3000;  done;
