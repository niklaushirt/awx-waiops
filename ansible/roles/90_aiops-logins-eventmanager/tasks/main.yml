
# *************************************************************************************************************************************************
# --------------------------------------------------------------------------------------------------------------------------------------
# Connection Details
# --------------------------------------------------------------------------------------------------------------------------------------
# *************************************************************************************************************************************************

# *************************************************************************************************************************************************
# --------------------------------------------------------------------------------------------------------------------------------------
# Get Cluster FQDN
# --------------------------------------------------------------------------------------------------------------------------------------
# *************************************************************************************************************************************************

- name: PREREQUISITES -  🌏 Get Cluster FQDN
  shell: |
    CLUSTER_ROUTE=$(oc get routes console -n openshift-console | tail -n 1 2>&1 ) 
    CLUSTER_FQDN=$( echo $CLUSTER_ROUTE | awk '{print $2}')
    echo ${CLUSTER_FQDN##*console.}
  register: CLUSTER_NAME






# --------------------------------------------------------------------------------------------------------------------------------------
# EventManager
# --------------------------------------------------------------------------------------------------------------------------------------
- name: CHECK -  🔎 ADDONS - EventManager
  k8s_info:
    kind: Namespace
    name: "{{ EVTMGR_NAMESPACE }}"
  register: K8S_EXISTS

- name: LOGIN -  🚀 ADDONS - EventManager
  block:
  - name: LOGIN -  🚀 ADDONS - EventManager
    shell: |
      echo "**********************************************************************************************************************************"
      echo "EventManager Connection Details"
      echo "**********************************************************************************************************************************"
      echo "            🌏 URL:      https://$(oc get route -n {{ EVTMGR_NAMESPACE }}  evtmanager-ibm-hdm-common-ui -o jsonpath={.spec.host})"
      echo ""
      echo "            🧑 User:     smadmin"
      echo "            🔐 Password: $(oc get secret -n {{ EVTMGR_NAMESPACE }}  evtmanager-was-secret -o jsonpath='{.data.WAS_PASSWORD}'| base64 --decode && echo)"
    register: output_string
    ignore_errors: yes
  - name: LOGIN -          🔐 EventManager
    debug: 
      var: output_string.stdout_lines
    #when: PRINT_LOGINS == true
  when: K8S_EXISTS.resources|length != 0


